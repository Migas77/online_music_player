{% extends 'layout.html' %} {% block content %} {% load static %}

<link rel="stylesheet" type="text/css" href="{% static 'css/artist.css' %}" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<div>
    <div>
        <h1>Artist Details</h1>
    </div>
    <br />
    <div class="flex justify-center items-center h-screen"
        style="width: 1000px; text-align: center; display: block; margin-left: auto; margin-right: auto;">
        <div class="card w-2/3 bg-base-100 shadow-xl">
            <figure><img src="{{ artist_details.image.url }}" alt="{{ artist_details.name }}" style="width: 1000px;" />
            </figure>
            <div class="card-body">
                <h1 class="songPerformer card-title">{{ artist_details.name }}</h1>
                <div class="card-actions justify-end">
                    <button class="btn btn-outline btn-primary" onclick="my_modal_1.showModal()">Show Details</button>
                    <button class="btn btn-outline btn-secondary" onclick="togglePlay('{{album.id}}')">Listen</button>
                </div>
            </div>
        </div>
    </div>
    <dialog id="my_modal_1" class="modal">
        <div class="modal-box" style="width: 700px;">
            <h2 style="font-size: 20px;"> <strong>Description:</strong></h2>
            <p class="py-4">{{ artist_details.description }}</p>
            <br>
            {% if artist_type == "Band" %}
            <h2 style="font-size: 20px;"> <strong>Members:</strong></h2>
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 scrollable-row">
                {% for member in artist_details.members.all %}
                <div class="flex flex-col items-center">
                    <div class="avatar">
                        <div class="w-24 rounded w-24 rounded overflow-hidden">
                            <img src="{{ member.image.url }}" alt="{{ member.name }}" style="width: 150px;" />
                        </div>
                    </div>
                    <span><h3 style="margin-bottom: 10px;">{{ member.name }}</h3></span>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            <div class="modal-action">
                <form method="dialog">
                    <!-- if there is a button in form, it will close the modal -->
                    <button class="btn btn-outline btn-error">Close</button>
                </form>
            </div>
        </div>
    </dialog>
    <br />
    <h2 style="font-size: 35px;"> <strong>Albums</strong> </h2>
    <div class="divider"></div>
    <div class="flex h-screen"
        style="display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; width: 1000px; margin-left: 200px; margin-right: 200px;">
        {% for album in artist_albums %}
            <div class="album-card album-{{ album.id }}" style="margin-left: 20%; margin-top: 2%;">
                <div class="card lg:card-side bg-base-100 shadow-xl" style="width: 1200px;">
                    <figure><img src="{{album.image.url}}" alt="Album" style="width: 500px;" class="image_tp"/></figure>
                    <div class="card-body">
                        <h2 class="card-title" style="margin-bottom: 0px;">{{ album.name }}</h2>
                        <div class="album-details">
                            <p style="font-size: 14px;"> <i class="fa-regular fa-clock" style="color: #c061cb;"></i> {{ album.duration }} <i class="fa-regular fa-calendar" style="color: #c061cb;"></i> {{ album.release_date }}</p>
                        </div>
                        <ul class="album_songs">
                            {% for music in artist_musics %}
                                {% if music.album == album %}
                                    <li class="songitem-{{ album.id }}">
                                        <div class="songitem_tp">
                                            <span class="song-info">
                                                <div class="play-button" onclick="togglePlayAlbum('{{ album.id }}')">
                                                    <i class="songItemPlay far fa-play-circle" data-song-url="{{ music.audio_file.url }}"></i>
                                                </div>
                                                <span class="songName name"><strong>{{ music.name }}</strong></span>
                                                <span class="info">
                                                    <strong>
                                                        {% if user.is_authenticated %}
                                                            {% if music.user_liked %}
                                                                <button class="like-button" onclick="toggleLike(event, '{{ music.id }}', '{{ user.id }}')">
                                                                    <i class="heart-icon fas fa-heart songItemPlay" style="color: #c061cb;"></i>
                                                                </button>
                                                                <span id="likes-count-{{ music.id }}">  {{ music.total_likes }}</span>
                                                           
                                                            {% else %}
                                                                <button class="like-button" onclick="toggleLike(event, '{{ music.id }}', '{{ user.id }}')">
                                                                    <i class="heart-icon far fa-heart songItemPlay" style="color: #c061cb;"></i>
                                                                </button>
                                                                <span id="likes-count-{{ music.id }}">  {{ music.total_likes }}</span>
                                                            {% endif %}
                                                        {% else %}
                                                            <button class="like-button" onclick="showAlertAndRedirect()"> 
                                                                <i class="heart-icon far fa-heart songItemPlay" style="color: #c061cb;"></i> {{ music.total_likes }}
                                                            </button>
                                                        {% endif %}
                                                    </strong>
                                                </span>
                                                <div class="info"> <strong><i class="fa-regular fa-clock" style="color: #c061cb;"></i> {{ music.duration }}</strong> <span class="songPerformer m-5"> {{ song }}</span> </div>
                                            </span>
                                        </div>
                                    </li>
                                {% endif %}
                            {% endfor %}
                        </ul>
                        <div class="card-actions justify-end">
                            <button class="btn btn-outline btn-secondary" onclick="togglePlayAlbum('{{album.id}}')">Listen</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <div class="bottom_tp margin">
        <input type="range" name="range" id="ProgressBar" min="0" max="100" />
        <div class="songinfo-container_tp">
            <div class="songinfo_tp">
                <img
                src="{% static 'images/playing.gif' %}"
                width="45px"
                alt=""
                id="gif"
                />
                <span id="masterSongName"></span>
            </div>
            <div class="icon">
                <button>
                    <i class="fas fa-2x fa-step-backward" id="previous"></i>
                    <i class="far fa-2x fa-play-circle" id="masterPlay"></i>
                    <i class="fas fa-2x fa-step-forward" id="next"></i>
                </button>
            </div>
        </div>
      </div>
</div>
<script src="{% static 'scripts/playmusic_albums.js' %}"></script>
<script src="{% static 'scripts/jquery-3.4.1.min.js' %}"></script>
<script>
    function toggleLike(event, musicId, userId) {
        var $icon = $(event.currentTarget).find(".heart-icon");
        var $likesCount = $(event.currentTarget).next();
        var isLiked = $icon.hasClass("fas");

        $.ajax({
            url: isLiked ? '{% url "removeLike" %}' : '{% url "addLike" %}',
            data: {
                csrfmiddlewaretoken: "{{ csrf_token }}",
                music_id: musicId,
                user_id: userId,
            },
            method: "POST",
            success: function (response) {
                if (response.success === true) {
                    if (isLiked) {
                        $icon.removeClass("fas");
                        $icon.addClass("far");
                    } else {
                        $icon.removeClass("far");
                        $icon.addClass("fas");
                    }
                    $likesCount.text(response.likes);
                    $icon.addClass("animated-heart");

                    setTimeout(function () {
                        $icon.removeClass("animated-heart");
                    }, 1000);
                }
            },
        });
    }

    function showAlertAndRedirect() {
        alert("Please log in to like this song");
        window.location.href = '/login_signup/'
    } 
</script>
{% endblock %}