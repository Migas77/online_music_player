{% extends 'layout.html' %}

{% block content %}

{% load static %}
<link rel="stylesheet" type="text/css" href="{% static 'css/artist.css' %}" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<div>
    <div>
        <h1>Artist Details</h1>
    </div>
    <br />
    <div class="flex justify-center items-center h-screen"
        style="width: 1000px; text-align: center; display: block; margin-left: auto; margin-right: auto;">
        <div class="card w-2/3 bg-base-100 shadow-xl">
            <figure><img src="{{ artist_details.image.url }}" alt="{{ artist_details.name }}" style="width: 1000px;" />
            </figure>
            <div class="card-body">
                <h1 class="card-title">{{ artist_details.name }}</h1>
                <div class="card-actions justify-end">
                    <button class="btn" onclick="my_modal_1.showModal()">Show Details</button>
                </div>
            </div>
        </div>
    </div>
    <dialog id="my_modal_1" class="modal">
        <div class="modal-box" style="width: 600px;">
            <h2 style="font-size: 20px;"> <strong>Description:</strong></h2>
            <p class="py-4">{{ artist_details.description }}</p>
            <br>
            {% if artist_type == "Band" %}
            <h2 style="font-size: 20px;"> <strong>Members:</strong></h2>
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                {% for member in artist_details.members.all %}
                <div class="flex flex-col items-center">
                    <div class="avatar">
                        <div class="w-24 rounded w-24 rounded overflow-hidden">
                            <img src="{{ member.image.url }}" alt="{{ member.name }}" style="width: 150px;" />
                        </div>
                    </div>
                    <h3>{{ member.name }}</h3>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            <div class="modal-action">
                <form method="dialog">
                    <!-- if there is a button in form, it will close the modal -->
                    <button class="btn">Close</button>
                </form>
            </div>
        </div>
    </dialog>
    <br />
    <br />
    <h2 style="font-size: 35px;"> <strong>Albums</strong> </h2>
    <div class="flex flex-row">
        {% for album in artist_albums %}
        <div class="flex flex-col justify-between ">
            <div class="card lg:card-side bg-base-100 shadow-xl">
                <figure><img src="{{album.image.url}}" alt="Album"/></figure>
                <div class="card-body">
                  <h2 class="card-title">{{album.name}}</h2>
                  <ul class="album_songs">
                    {% for music in artist_musics %}
                      {% if music.album == album %}
                        <li>
                            <strong>{{ music.name }}</strong>
                            <span class="info" id="likes-count-{{music.name}}"> <strong> <i class="fa-regular fa-heart" style="color: #c061cb;"></i> {{ music.likes }}</strong></span>
                            <div class="info"> <strong> <button class="like-button" data-music-name="{{ music.name }}"><i class="fa-regular fa-clock" style="color: #c061cb;"></i></button> {{ music.duration }}</strong></div>
                        </li>
                      {% endif %}
                    {% endfor %}
                  </ul>
                  <div class="card-actions justify-end">
                    <button class="btn btn-primary">Listen</button>
                  </div>
                </div>
              </div>
        </div>
        {% endfor %}
    </div>
    <div class="card lg:card-side bg-base-100 shadow-xl">
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        $(".like-button").click(function () {
            var musicName = $(this).data("music-name");
            var $icon = $(this).data("")

            $.ajax({
                url:"/like-song/" + musicName + "/",
                type: "POST",
                dataType: "json",
                success: function (data) {
                    if(data.success) {
                        $("#likes-count-" + musicName).text(data.likes);
                    } else {

                        alert("Error: " + data.error);
                    }
                },
                error: function() {
                    alert("An error occurred while processing your request")
                },
            });
        });
    });
</script>
{% endblock %}